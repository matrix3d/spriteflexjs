/**
 * Generated by Apache Royale Compiler from Box2D/Dynamics/Joints/b2MouseJoint.as
 * Box2D.Dynamics.Joints.b2MouseJoint
 *
 * @fileoverview
 *
 * @suppress {missingRequire|checkTypes|accessControls}
 */

goog.provide('Box2D.Dynamics.Joints.b2MouseJoint');
/* Royale Dependency List: Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Vec2,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2TimeStep*/

goog.require('Box2D.Dynamics.Joints.b2Joint');



/** @asprivate 
 * @constructor
 * @extends {Box2D.Dynamics.Joints.b2Joint}
 * @param {Box2D.Dynamics.Joints.b2MouseJointDef} def
 */
Box2D.Dynamics.Joints.b2MouseJoint = function(def) {
  
  this.Box2D_Dynamics_Joints_b2MouseJoint_K = new Box2D.Common.Math.b2Mat22();
  this.Box2D_Dynamics_Joints_b2MouseJoint_K1 = new Box2D.Common.Math.b2Mat22();
  this.Box2D_Dynamics_Joints_b2MouseJoint_K2 = new Box2D.Common.Math.b2Mat22();
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor = new Box2D.Common.Math.b2Vec2();
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_target = new Box2D.Common.Math.b2Vec2();
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse = new Box2D.Common.Math.b2Vec2();
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_mass = new Box2D.Common.Math.b2Mat22();
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_C = new Box2D.Common.Math.b2Vec2();
  Box2D.Dynamics.Joints.b2MouseJoint.base(this, 'constructor', def);
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_target.SetV(def.target);
  var /** @type {number} */ tX = this.Box2D_Dynamics_Joints_b2MouseJoint_m_target.x - this.m_bodyB.m_xf.position.x;
  var /** @type {number} */ tY = this.Box2D_Dynamics_Joints_b2MouseJoint_m_target.y - this.m_bodyB.m_xf.position.y;
  var /** @type {Box2D.Common.Math.b2Mat22} */ tMat = this.m_bodyB.m_xf.R;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor.x = (tX * tMat.col1.x + tY * tMat.col1.y);
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor.y = (tX * tMat.col2.x + tY * tMat.col2.y);
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_maxForce = def.maxForce;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.SetZero();
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_frequencyHz = def.frequencyHz;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_dampingRatio = def.dampingRatio;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_beta = 0.0;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma = 0.0;
};
goog.inherits(Box2D.Dynamics.Joints.b2MouseJoint, Box2D.Dynamics.Joints.b2Joint);


/** @inheritDoc 
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorA = function() {
  return this.Box2D_Dynamics_Joints_b2MouseJoint_m_target;
};


/** @inheritDoc 
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorB = function() {
  return this.m_bodyB.GetWorldPoint(this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor);
};


/** @inheritDoc 
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionForce = function(inv_dt) {
  return new Box2D.Common.Math.b2Vec2(inv_dt * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x, inv_dt * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y);
};


/** @inheritDoc 
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionTorque = function(inv_dt) {
  return 0.0;
};


/**
 * @return {Box2D.Common.Math.b2Vec2}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetTarget = function() {
  return this.Box2D_Dynamics_Joints_b2MouseJoint_m_target;
};


/**
 * Use this to update the target point.
 * @param {Box2D.Common.Math.b2Vec2} target
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetTarget = function(target) {
  if (this.m_bodyB.IsAwake() == false) {
    this.m_bodyB.SetAwake(true);
  }
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_target = target;
};


/**
 * @return {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetMaxForce = function() {
  return this.Box2D_Dynamics_Joints_b2MouseJoint_m_maxForce;
};


/**
 * @param {number} maxForce
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetMaxForce = function(maxForce) {
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_maxForce = maxForce;
};


/**
 * @return {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetFrequency = function() {
  return this.Box2D_Dynamics_Joints_b2MouseJoint_m_frequencyHz;
};


/**
 * @param {number} hz
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetFrequency = function(hz) {
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_frequencyHz = hz;
};


/**
 * @return {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetDampingRatio = function() {
  return this.Box2D_Dynamics_Joints_b2MouseJoint_m_dampingRatio;
};


/**
 * @param {number} ratio
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetDampingRatio = function(ratio) {
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_dampingRatio = ratio;
};


/**
 * @private
 * @type {Box2D.Common.Math.b2Mat22}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_K = null;


/**
 * @private
 * @type {Box2D.Common.Math.b2Mat22}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_K1 = null;


/**
 * @private
 * @type {Box2D.Common.Math.b2Mat22}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_K2 = null;


/**
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.InitVelocityConstraints = function(step) {
  var /** @type {Box2D.Common.Math.b2Mat22} */ tMat = null;
  var /** @type {Box2D.Dynamics.b2Body} */ b = this.m_bodyB;
  var /** @type {number} */ mass = b.GetMass();
  var /** @type {number} */ omega = 2.0 * Math.PI * this.Box2D_Dynamics_Joints_b2MouseJoint_m_frequencyHz;
  var /** @type {number} */ d = 2.0 * mass * this.Box2D_Dynamics_Joints_b2MouseJoint_m_dampingRatio * omega;
  var /** @type {number} */ k = mass * omega * omega;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma = step.dt * (d + step.dt * k);
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma = this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma != 0 ? 1 / this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma : 0.0;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_beta = step.dt * k * this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma;
  //var /** @type {Box2D.Common.Math.b2Mat22} */ tMat = null;
  tMat = b.m_xf.R;
  var /** @type {number} */ rX = this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor.x - b.m_sweep.localCenter.x;
  var /** @type {number} */ rY = this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor.y - b.m_sweep.localCenter.y;
  var /** @type {number} */ tX = (tMat.col1.x * rX + tMat.col2.x * rY);
  rY = (tMat.col1.y * rX + tMat.col2.y * rY);
  rX = tX;
  var /** @type {number} */ invMass = b.m_invMass;
  var /** @type {number} */ invI = b.m_invI;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K1.col1.x = invMass;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K1.col2.x = 0.0;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K1.col1.y = 0.0;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K1.col2.y = invMass;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K2.col1.x = invI * rY * rY;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K2.col2.x = -invI * rX * rY;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K2.col1.y = -invI * rX * rY;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K2.col2.y = invI * rX * rX;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K.SetM(this.Box2D_Dynamics_Joints_b2MouseJoint_K1);
  this.Box2D_Dynamics_Joints_b2MouseJoint_K.AddM(this.Box2D_Dynamics_Joints_b2MouseJoint_K2);
  this.Box2D_Dynamics_Joints_b2MouseJoint_K.col1.x += this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K.col2.y += this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma;
  this.Box2D_Dynamics_Joints_b2MouseJoint_K.GetInverse(this.Box2D_Dynamics_Joints_b2MouseJoint_m_mass);
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_C.x = b.m_sweep.c.x + rX - this.Box2D_Dynamics_Joints_b2MouseJoint_m_target.x;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_C.y = b.m_sweep.c.y + rY - this.Box2D_Dynamics_Joints_b2MouseJoint_m_target.y;
  b.m_angularVelocity *= 0.98;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x *= step.dtRatio;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y *= step.dtRatio;
  b.m_linearVelocity.x += invMass * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x;
  b.m_linearVelocity.y += invMass * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y;
  b.m_angularVelocity += invI * (rX * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y - rY * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x);
};


/**
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolveVelocityConstraints = function(step) {
  var /** @type {number} */ tX = NaN;
  var /** @type {number} */ tY = NaN;
  var /** @type {Box2D.Common.Math.b2Mat22} */ tMat = null;
  var /** @type {Box2D.Dynamics.b2Body} */ b = this.m_bodyB;
  //var /** @type {Box2D.Common.Math.b2Mat22} */ tMat = null;
  //var /** @type {number} */ tX = NaN;
  //var /** @type {number} */ tY = NaN;
  tMat = b.m_xf.R;
  var /** @type {number} */ rX = this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor.x - b.m_sweep.localCenter.x;
  var /** @type {number} */ rY = this.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor.y - b.m_sweep.localCenter.y;
  tX = (tMat.col1.x * rX + tMat.col2.x * rY);
  rY = (tMat.col1.y * rX + tMat.col2.y * rY);
  rX = tX;
  var /** @type {number} */ CdotX = b.m_linearVelocity.x + (-b.m_angularVelocity * rY);
  var /** @type {number} */ CdotY = b.m_linearVelocity.y + (b.m_angularVelocity * rX);
  tMat = this.Box2D_Dynamics_Joints_b2MouseJoint_m_mass;
  tX = CdotX + this.Box2D_Dynamics_Joints_b2MouseJoint_m_beta * this.Box2D_Dynamics_Joints_b2MouseJoint_m_C.x + this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x;
  tY = CdotY + this.Box2D_Dynamics_Joints_b2MouseJoint_m_beta * this.Box2D_Dynamics_Joints_b2MouseJoint_m_C.y + this.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma * this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y;
  var /** @type {number} */ impulseX = -(tMat.col1.x * tX + tMat.col2.x * tY);
  var /** @type {number} */ impulseY = -(tMat.col1.y * tX + tMat.col2.y * tY);
  var /** @type {number} */ oldImpulseX = this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x;
  var /** @type {number} */ oldImpulseY = this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x += impulseX;
  this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y += impulseY;
  var /** @type {number} */ maxImpulse = step.dt * this.Box2D_Dynamics_Joints_b2MouseJoint_m_maxForce;
  if (this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.LengthSquared() > maxImpulse * maxImpulse) {
    this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.Multiply(maxImpulse / this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.Length());
  }
  impulseX = this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.x - oldImpulseX;
  impulseY = this.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse.y - oldImpulseY;
  b.m_linearVelocity.x += b.m_invMass * impulseX;
  b.m_linearVelocity.y += b.m_invMass * impulseY;
  b.m_angularVelocity += b.m_invI * (rX * impulseY - rY * impulseX);
};


/**
 * @override
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolvePositionConstraints = function(baumgarte) {
  return true;
};


/**
 * @private
 * @type {Box2D.Common.Math.b2Vec2}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_localAnchor = null;


/**
 * @private
 * @type {Box2D.Common.Math.b2Vec2}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_target = null;


/**
 * @private
 * @type {Box2D.Common.Math.b2Vec2}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_impulse = null;


/**
 * @private
 * @type {Box2D.Common.Math.b2Mat22}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_mass = null;


/**
 * @private
 * @type {Box2D.Common.Math.b2Vec2}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_C = null;


/**
 * @private
 * @type {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_maxForce = NaN;


/**
 * @private
 * @type {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_frequencyHz = NaN;


/**
 * @private
 * @type {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_dampingRatio = NaN;


/**
 * @private
 * @type {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_beta = NaN;


/**
 * @private
 * @type {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.Box2D_Dynamics_Joints_b2MouseJoint_m_gamma = NaN;


/**
 * Metadata
 *
 * @type {Object.<string, Array.<Object>>}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.ROYALE_CLASS_INFO = { names: [{ name: 'b2MouseJoint', qName: 'Box2D.Dynamics.Joints.b2MouseJoint', kind: 'class' }] };



/**
 * Reflection
 *
 * @return {Object.<string, Function>}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.ROYALE_REFLECTION_INFO = function () {
  return {
    methods: function () {
      return {
        'GetAnchorA': { type: 'Box2D.Common.Math.b2Vec2', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint'},
        'GetAnchorB': { type: 'Box2D.Common.Math.b2Vec2', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint'},
        'GetReactionForce': { type: 'Box2D.Common.Math.b2Vec2', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Number', false ]; }},
        'GetReactionTorque': { type: 'Number', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Number', false ]; }},
        'GetTarget': { type: 'Box2D.Common.Math.b2Vec2', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint'},
        'SetTarget': { type: 'void', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Box2D.Common.Math.b2Vec2', false ]; }},
        'GetMaxForce': { type: 'Number', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint'},
        'SetMaxForce': { type: 'void', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Number', false ]; }},
        'GetFrequency': { type: 'Number', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint'},
        'SetFrequency': { type: 'void', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Number', false ]; }},
        'GetDampingRatio': { type: 'Number', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint'},
        'SetDampingRatio': { type: 'void', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Number', false ]; }},
        'b2MouseJoint': { type: '', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Box2D.Dynamics.Joints.b2MouseJointDef', false ]; }},
        'InitVelocityConstraints': { type: 'void', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Box2D.Dynamics.b2TimeStep', false ]; }},
        'SolveVelocityConstraints': { type: 'void', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Box2D.Dynamics.b2TimeStep', false ]; }},
        'SolvePositionConstraints': { type: 'Boolean', declaredBy: 'Box2D.Dynamics.Joints.b2MouseJoint', parameters: function () { return [ 'Number', false ]; }}
      };
    }
  };
};
/**
 * @const
 * @type {number}
 */
Box2D.Dynamics.Joints.b2MouseJoint.prototype.ROYALE_COMPILE_FLAGS = 9;
